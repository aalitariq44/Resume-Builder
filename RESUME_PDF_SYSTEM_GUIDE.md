# دليل نظام طباعة PDF المتكامل

## نظرة عامة

تم إنشاء نظام طباعة PDF قوي ومنظم للسير الذاتية يدعم اللغة العربية بشكل كامل مع اتجاه RTL وحجم ورقة A4. النظام مبني باستخدام `@react-pdf/renderer` ويوفر مميزات احترافية للتصدير والطباعة.

## المميزات الرئيسية

### 🎯 **دعم اللغة العربية**
- **خطوط Cairo المُحسنة**: خطوط عربية احترافية بأوزان متعددة
- **اتجاه RTL**: دعم كامل لاتجاه النص من اليمين إلى اليسار
- **محاذاة صحيحة**: محاذاة النصوص والعناصر بشكل صحيح للعربية

### 📄 **مواصفات الصفحة**
- **حجم A4**: 210 × 297 مم (595.28 × 841.89 نقطة)
- **هوامش منتظمة**: 20 مم من جميع الجهات
- **تخطيط مرن**: يدعم عمود واحد أو عمودين
- **طباعة عالية الجودة**: محسن للطباعة المنزلية والتجارية

### 🛠️ **وظائف التصدير**
- **تحميل PDF**: حفظ الملف مباشرة على الجهاز
- **معاينة**: فتح PDF في نافذة جديدة للمراجعة
- **طباعة مباشرة**: طباعة فورية بدون حفظ
- **مشاركة**: نسخ رابط أو مشاركة عبر Web Share API

## هيكل النظام

```
src/lib/pdf/
├── fonts.ts          # إدارة الخطوط العربية
├── styles.ts         # أنماط CSS للـ PDF
├── PDFResume.tsx     # مكون السيرة الذاتية
├── utils.tsx         # وظائف التصدير والمساعدة
└── index.ts          # فهرسة وتصدير النظام
```

## الاستخدام

### 1. **في صفحة البناء (Builder)**
```tsx
import PDFControlsSimple from '@/components/ui/PDFControlsSimple';

<PDFControlsSimple 
  resume={resume} 
  showSystemInfo={false}
/>
```

### 2. **في صفحة الاختبار**
```tsx
// زيارة /pdf-test للوصول لصفحة الاختبار
<PDFControlsSimple 
  resume={resume} 
  showSystemInfo={true}
/>
```

### 3. **استخدام مباشر للوظائف**
```tsx
import { downloadPDF, previewPDF, validateResumeForPDF } from '@/lib/pdf';

// تحميل PDF
await downloadPDF(resume);

// معاينة PDF
await previewPDF(resume);

// التحقق من صحة البيانات
const validation = validateResumeForPDF(resume);
```

## أقسام السيرة الذاتية المدعومة

### ✅ **الأقسام الأساسية**
1. **المعلومات الشخصية**
   - الاسم الكامل
   - المسمى الوظيفي
   - معلومات الاتصال
   - الصورة الشخصية (اختياري)

2. **الهدف المهني**
   - نص مفتوح للهدف الوظيفي

3. **الخبرة العملية**
   - المسمى الوظيفي
   - اسم الشركة
   - الموقع والتواريخ
   - الوصف والمسؤوليات
   - الإنجازات

4. **التعليم**
   - الدرجة العلمية
   - التخصص
   - اسم المؤسسة
   - التواريخ والمكان

### 🎨 **الأقسام التكميلية**
5. **المهارات**
   - المهارات التقنية والشخصية
   - مستوى الإتقان مع شريط تقدم
   - تصنيف حسب الفئة

6. **اللغات**
   - اسم اللغة
   - مستوى الإتقان
   - دعم معايير CEFR (A1-C2)

7. **الدورات التدريبية**
   - اسم الدورة
   - مقدم الدورة
   - تاريخ الإكمال

8. **الجوائز والإنجازات**
   - عنوان الجائزة
   - الجهة المانحة
   - التاريخ والوصف

9. **الهوايات والاهتمامات**
   - قائمة بالهوايات
   - مستوى الممارسة

10. **المراجع**
    - اسم الشخص المرجعي
    - المنصب والشركة
    - معلومات الاتصال

## التخصيص والتصميم

### 🎨 **الثيمات والألوان**
```tsx
// تخصيص الألوان
theme: {
  colors: {
    primary: '#3b82f6',     // اللون الأساسي
    secondary: '#6b7280',   // اللون الثانوي
    text: '#1f2937',        // لون النص
    background: '#ffffff',  // لون الخلفية
    border: '#e5e7eb'       // لون الحدود
  }
}
```

### 📝 **الخطوط والأحجام**
```tsx
fonts: {
  heading: 'Cairo',         // خط العناوين
  body: 'Cairo',           // خط النص
  size: {
    base: 14,              // حجم النص الأساسي
    heading: 18,           // حجم العناوين
    small: 12              // حجم النص الصغير
  }
}
```

### 📐 **التخطيط والمسافات**
```tsx
layout: {
  columns: 1,              // عدد الأعمدة
  spacing: 'normal',       // المسافات بين العناصر
  margins: {
    top: 20,               // هامش علوي
    right: 20,             // هامش يميني
    bottom: 20,            // هامش سفلي
    left: 20               // هامش يساري
  }
}
```

## التحقق من صحة البيانات

### ✅ **المتطلبات الأساسية**
- الاسم الأول (مطلوب)
- اسم العائلة (مطلوب)
- البريد الإلكتروني (مطلوب)
- رقم الهاتف (مطلوب)
- قسم واحد على الأقل من المحتوى

### ⚠️ **رسائل الخطأ**
```tsx
const validation = validateResumeForPDF(resume);
if (!validation.isValid) {
  console.log(validation.errors);
  // ['الاسم الأول مطلوب', 'البريد الإلكتروني مطلوب']
}
```

## الأداء والذاكرة المؤقتة

### 💾 **حفظ مؤقت**
```tsx
// حفظ PDF في localStorage
const cacheKey = await savePDFToCache(resume);

// استرجاع من الذاكرة المؤقتة
const cachedPDF = getPDFFromCache(resumeId);

// مسح الذاكرة المؤقتة
clearPDFCache(resumeId);
```

### ⚡ **تحسين الأداء**
- تحميل الخطوط مرة واحدة
- ضغط الصور تلقائياً
- تحسين حجم الملف
- معالجة الأخطاء الذكية

## استكشاف الأخطاء

### 🔧 **المشاكل الشائعة وحلولها**

#### 1. **مشكلة الخطوط**
```bash
# تأكد من وجود ملفات الخطوط في
public/fonts/Cairo-*.ttf
```

#### 2. **مشكلة التشفير**
```tsx
// تأكد من تشفير UTF-8 للنصوص العربية
<Text style={{ fontFamily: 'Cairo' }}>النص العربي</Text>
```

#### 3. **مشكلة الاتجاه**
```tsx
// تأكد من ضبط اتجاه RTL
direction: 'rtl',
textAlign: 'right'
```

### 🚨 **معالجة الأخطاء**
```tsx
try {
  await downloadPDF(resume);
} catch (error) {
  console.error('خطأ في تحميل PDF:', error);
  // عرض رسالة خطأ للمستخدم
}
```

## التطوير والتوسع

### 🔄 **إضافة قوالب جديدة**
```tsx
// إنشاء مكون قالب جديد
const ModernTemplate = ({ resume, styles }) => {
  return (
    <Document>
      <Page size="A4" style={styles.page}>
        {/* محتوى القالب */}
      </Page>
    </Document>
  );
};
```

### 🎯 **إضافة أقسام جديدة**
```tsx
// إضافة قسم جديد للمشاريع
const ProjectsSection = ({ resume, styles }) => {
  if (!resume.projects?.length) return null;
  
  return (
    <View style={styles.section}>
      <Text style={styles.sectionTitle}>المشاريع</Text>
      {/* محتوى القسم */}
    </View>
  );
};
```

## اختبار النظام

### 🧪 **صفحة الاختبار**
زيارة: `http://localhost:3001/pdf-test`

### ✅ **قائمة الفحص**
- [ ] تحميل الخطوط بنجاح
- [ ] عرض النص العربي بشكل صحيح
- [ ] اتجاه RTL يعمل
- [ ] تحميل PDF بدون أخطاء
- [ ] معاينة PDF تعمل
- [ ] طباعة تعمل بشكل صحيح
- [ ] مشاركة تعمل

## الدعم التقني

### 📚 **المراجع**
- [React PDF Documentation](https://react-pdf.org/)
- [Cairo Font Family](https://fonts.google.com/specimen/Cairo)
- [RTL Text Direction](https://developer.mozilla.org/en-US/docs/Web/CSS/direction)

### 💬 **الحصول على المساعدة**
- فحص ملفات الخطوط
- مراجعة console للأخطاء
- اختبار صفحة `/pdf-test`
- فحص Network tab في Developer Tools

---

## خلاصة

نظام PDF المتكامل يوفر حلاً شاملاً لإنشاء السير الذاتية بجودة احترافية مع دعم كامل للغة العربية. النظام قابل للتخصيص والتوسع ومحسن للأداء والجودة.

**المميزات الأساسية:**
- ✅ دعم كامل للعربية مع RTL
- ✅ حجم A4 احترافي
- ✅ خطوط Cairo محسنة
- ✅ تصدير متعدد الصيغ
- ✅ معاينة وطباعة مباشرة
- ✅ تحقق من صحة البيانات
- ✅ أداء محسن
- ✅ واجهة سهلة الاستخدام
